name: Approval Test Flow

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # Allows you to click "Run" manually for testing

jobs:
  # 1. Sandbox runs automatically (No environment rules set)
  sandbox-up:
    name: Deploy to Sandbox
    runs-on: ubuntu-latest
    environment: sandbox
    steps:
      - name: Simulate Deployment
        run: echo "ðŸš€ Deploying to Sandbox... Done!"

  # 2. Nonprod pauses for approval (Because we set 'Required Reviewers' in Settings)
  nonprod-up:
    name: Deploy to NonProd
    runs-on: ubuntu-latest
    environment: nonprod
    needs: [sandbox-up] # Won't start until Sandbox finishes
    steps:
      - name: Simulate Deployment
        run: echo "ðŸš€ Deploying to NonProd... Done!"

  # 3. Production pauses for approval AND waits for Nonprod to finish
  production-up:
    name: Deploy to Production
    runs-on: ubuntu-latest
    environment: production
    needs: [nonprod-up] # Won't start until NonProd finishes
    steps:
      - name: Simulate Deployment
        run: echo "ðŸš€ Deploying to Production... Done!"